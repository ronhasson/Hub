<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>TOS Remote</title>
    <meta id="addressbarColorAndroid" name="theme-color" content="#69019a">
    <meta id="addressbarColorIOS" name="apple-mobile-web-app-status-bar-style" content="#69019a">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">
</head>

<style>
    .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #d7d7d7;
        overflow-x: hidden;
        padding-top: 9.5vh;
        transition: 0.5s;
    }
    
    .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 4vh;
        color: #1f1f1f;
        display: block;
        transition: 0.3s;
        border: 5px;
        font-family: sans-serif;
    }
    
    .sidenav a:hover,
    .offcanvas a:focus {
        color: #18436b;
    }
    
    .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        margin-left: 50px;
    }
    
    #main {
        transition: margin-left .5s;
        padding-top: 2vh;
        padding-left: 3vw;
        font-size: 3vh;
    }
    
    #topBar {
        background-color: rgb(45, 110, 236);
        width: 100vw;
        margin: 0;
        height: 11vw;
        box-shadow: 0px 0px 19px 0px rgba(0, 0, 0, 0.75);
    }
    
    .opener {
        vertical-align: middle;
        font-size: 6.5vw;
        margin-left: 3vw;
        position: absolute;
        margin-top: 1.5vw;
        cursor: pointer;
    }
    
    .inTopBar {
        vertical-align: middle;
        font-size: 6vw;
        margin-left: 1.5vw;
        margin-right: 4vw;
        margin-top: 2vw;
        float: right;
        cursor: pointer;
    }
</style>

<body style="background-color: #d0e0e7;margin:0">
    <div id="start">
        <center>
            <div style="height: 50vh;width:75vw;background-color:rgba(106, 34, 247, 0.8);margin-top: 13vh;">
                <h1 style="font-family: serif;font-size: 6vh;padding-top: 7vh; padding-bottom: 5vh;"><i>Your name:</i></h1>
                <input id="usernameInput" required style="width: 28vw;height: 3vh;font-size: 2.5vh;margin-bottom: 4vh;" />
                <br />
                <input type="button" value="join" onclick="requestUsername()" style="height: 3vh;width: 13vw;border-radius: 15px;font-size: 2vh;"
                />
                <br />
                <span id="error"></span>
            </div>
        </center>
    </div>
    <div id="waiting" style="display:none">
        <h1 id="userView"></h1>
    </div>

    <div id="inGame" style="display:none" class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" style="font-size: 5.5vh" onclick="closeNav()">
                <span id="nameView" style="font-size: 3.5vh;float: left;padding-top: 1vh;position: absolute ; left: -25vw;">name</span><span>&times;</span>
            </a>
            <a onclick="changeTab('chat')">Chat</a>
            <a onclick="changeTab('actions')">Actions</a>
            <a onclick="changeTab('role')">Role</a>
        </div>

        <div id="topBar">
            <span onclick="openNav()" class="opener"><i class="fa fa-bars" aria-hidden="true"></i></span>
            <span class="inTopBar" id="phases"></span>
            <span class="inTopBar" style="color:rgb(250, 255, 0);display:none" id="sun"><i class="fa fa-sun-o" aria-hidden="true"></i></span>
            <span class="inTopBar" style="color:rgb(198, 26, 9);display:none" id="deathNote"><i class="fa fa-sticky-note" aria-hidden="true"></i></span>
            <span class="inTopBar" style="color:rgb(245, 231, 184)" id="will"><i class="fa fa-sticky-note" aria-hidden="true"></i></span>
        </div>

        <div id="chatMenu">
            <!--
              all, mafia, vamp, jailor,dead, siance
             !-->
            <center>
                <textarea id="log" readonly style="resize: none;width:83vw;height:72vh;margin-top:3vh;font-size:3.3vw;" rows="20" cols="50"></textarea>
                <br />
                <input type="text" id="message" style="height:8vw;font-size:4.2vw;width:78vw;bottom:0;left:0;position:fixed;" />
                <button type="button" onclick="sendMessageToServer()" style="height:9vw;font-size:5vw;width:22vw;bottom:0;right:0;position:fixed;color:rgb(255,255,255);background-color:rgb(45, 110, 236)"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>
            </center>
        </div>

        <div id="actions" style="display: none">

        </div>

        <div id="role" style="font-family: sans-serif;white-space: pre-line;padding:27px; display: none">
            <center><img id="RoleImage" style="height:27vh;" /></center>
            <h1 id="RoleName" style="text-align: center;margin:0"></h1>
            <p id="AlignmentRole" style="margin:0;"></p>
            <p id="AbilitiesRole" style="margin:0;"></p>
            <p id="AttributesRole" style="margin:0;"></p>
            <p id="GoalRole" style="margin:0;"></p>
        </div>
    </div>

</body>
<script>
    function openNav() {
        document.getElementById("mySidenav").style.width = "39vw";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
    }

    function updateRoleText() {
        document.getElementById('RoleName').innerHTML = player.role.name;
        document.getElementById('RoleImage').src = player.role.info.img;
        document.getElementById('AlignmentRole').innerHTML = "<b>Alignment:</b>\n " + player.role.info.Alignment;
        document.getElementById('AbilitiesRole').innerHTML = "<b>Abilities:</b>\n " + player.role.info.Abilities;
        document.getElementById('AttributesRole').innerHTML = "<b>Attributes:</b>\n " + player.role.info.Attributes;
        document.getElementById('GoalRole').innerHTML = "<b>Goal:</b>\n " + player.role.info.Goal;
    }
</script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
    var socket = io();
    var uid = guid();

    var player;
    var roles;

    var mafiaList = {};
    var vampireList = {};
    var nameList = {};


    socket.emit("join", uid);

    socket.on('getMessage', function(data) {
        document.getElementById("log").value += data.username + ": " + data.message + "\n";
    });


    function changeTab(tab) {
        document.getElementById("chatMenu").style.display = 'none';
        document.getElementById("actions").style.display = 'none';
        document.getElementById("role").style.display = 'none';
        if (tab == "chat") {
            document.getElementById("chatMenu").style.display = '';
        }
        if (tab == "actions") {
            document.getElementById("actions").style.display = '';
        }
        if (tab == "role") {
            document.getElementById("role").style.display = '';
        }
    }

    function sendMessageToServer() {
        var message = document.getElementById("message").value;
        document.getElementById("message").focus();
        if(message == "")
        {
          return false;
        }
        socket.emit("sendMessage", {
            message: message,
            player: player
        });
        document.getElementById("message").value = "";
    }

    function requestUsername() {
        var TEMP_username = document.getElementById("usernameInput").value;
        socket.emit("requestUserN", {
            usr: TEMP_username,
            uid: uid
        });
    }
    socket.on('requestUserNCallBack', function(data) {
        if (!data.flag && uid == data.uid) {
            var username = data.usr;
            document.getElementById("start").style.display = 'none';
            document.getElementById("waiting").style.display = '';
            document.getElementById("userView").innerHTML = "Hello " + username;
        }
        if (data.flag && uid == data.uid) {
            document.getElementById("error").innerHTML = "Darling, the username is unavailable ðŸ’ƒ";
        }
    });

    function sendButtonPress(button) {
        socket.emit('buttonPress', button);
    }

    socket.on('changePageRemote', function(page) {
        document.location.href = "/" + page;
    });

    socket.on('getRoles', function(senRoles) {
        roles = senRoles;
    });

    function guid() {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000)
                .toString(16)
                .substring(1);
        }
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
            s4() + '-' + s4() + s4() + s4();
    }
    socket.on('startGame', function(data) {
        player = data.player;
        console.log(player.role.name);
        console.log(player.username);
        document.getElementById("nameView").innerHTML = player.username;
        if (player.role.canKill == true) {
            document.getElementById("deathNote").style.display = '';
        }
        if (player.role == roles.Jailor || player.role == roles.Mayor) {
            document.getElementById("sun").style.display = '';
        }
        document.getElementById("inGame").style.display = '';
        document.getElementById("waiting").style.display = 'none';
        updateRoleText();
    });

    socket.on('getMafia', function(data)
    {
        mafiaList = data.mafiaList;
    });
    socket.on('getVampires', function(data)
    {
        vampireList = data.vampireList;
    });
    socket.on('getNames', function(data)
    {
        nameList = data.nameList;
        console.log(nameList);
    });
</script>

</html>