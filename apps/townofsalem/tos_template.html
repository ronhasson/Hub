<template>

    <center>
        <h1></h1>
        <input type="button" value="Start!" onclick="start()" />
        <div id="usersInGame">

        </div>
    </center>
    <script>
        var rolePicker = require("./apps/townofsalem/rolePicker.js");
        var roles = require("./apps/townofsalem/roles.js");

        requestChangeRemotePage("tos");
        var players = [];

        function start() {
            var roleList;
            roleList = rolePicker.getRoles(Object.keys(players).length);
            roleList = rolePicker.checkValidation(roleList);
            keys = Object.keys(players);
            keys.sort();
            var i = 0;
            for(let uid in players){
              players[uid].role = roleList[i];
              i++;
            }
            console.log("start - " + players)
            sendEmit("startGame", players);
        }

        function addPlayer(uid) {
            var player = new Object();
            player.username = "";
            player.role = "";
            players[uid] = player;
            sendEmit("getRoles", roles);
            console.log("add player - " + player);
        }

        function checkUserName(data) {
            console.log(players);
            for (let uid in players) {
                let player = players[uid];
                console.log(player);
                if (player.username == data.usr) {
                    sendEmit("requestUserNCallBack", {
                        flag: true,
                        usr: data.usr,
                        uid: data.uid
                    });
                    return false;
                }
            }
            console.log("pass - " +players[data.uid]);
            players[data.uid].username = data.usr;
            sendEmit("requestUserNCallBack", {
                flag: false,
                usr: data.usr,
                uid: data.uid
            });
            displayUsers();
            console.log(players);
        }

        function displayUsers() {
            var disp = document.getElementById("usersInGame");
            disp.innerHTML = "";
            for (var uid in players) {
                let player = players[uid];
                if (player.username != "") {
                    disp.innerHTML += "<a class='playerWait' onclick='removePlayer(\"" + uid + "\")'>" + player.username + "</a></br>";
                }
            }
        }

        function removePlayer(uid) {
            players[uid].username = "";
            displayUsers();
        }
    </script>
</template>
