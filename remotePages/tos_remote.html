<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>TOS Remote</title>
    <meta id="addressbarColorAndroid" name="theme-color" content="#69019a">
    <meta id="addressbarColorIOS" name="apple-mobile-web-app-status-bar-style" content="#69019a">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">
</head>

<body>
    <div id="start">
        <center>
            <h1>Pick name!</h1>
            <input id="usernameInput" required />
            <p id="error"></p><br />
            <input type="button" value="join" onclick="requestUsername()" />
        </center>
    </div>
    <div id="waiting" style="display:none">
        <h1 id="userView"></h1>
    </div>
</body>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
    var socket = io();
    var uid = guid();
    var username;

    socket.emit("join", uid);

    function requestUsername() {
        var TEMP_username = document.getElementById("usernameInput").value;
        socket.emit("requestUserN", {
            usr: TEMP_username,
            uid: uid
        });
    }
    socket.on('requestUserNCallBack', function(data) {
        if (!data.flag && uid == data.uid) {
            username = data.usr;
            document.getElementById("start").style.display = 'none';
            document.getElementById("waiting").style.display = '';
            document.getElementById("userView").innerHTML = "Hello " + username;
        }
        if (data.flag && uid == data.uid) {
            document.getElementById("error").innerHTML = "Darling, the username is unavailable ðŸ’ƒ";
        }
    });

    function sendButtonPress(button) {
        socket.emit('buttonPress', button);
    }

    socket.on('changePageRemote', function(page) {
        document.location.href = "/" + page;
    });

    function guid() {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000)
                .toString(16)
                .substring(1);
        }
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
            s4() + '-' + s4() + s4() + s4();
    }
</script>

</html>
